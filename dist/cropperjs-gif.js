/*! Project: https://github.com/wmlgl/cropperjs-gif, license: MIT */
!function(t,e){for(var n in e)t[n]=e[n]}(window,function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=2)}({2:function(t,e,n){"use strict";function i(t){t.background=t.background||"#fff",this.options=t,this.containerCanvas=document.createElement("canvas"),this.containerCtx=this.containerCanvas.getContext("2d"),this.convertorCanvas=document.createElement("canvas"),this.convertorCtx=this.convertorCanvas.getContext("2d"),this.containerCenterX=null,this.containerCenterY=null,this.image=null,this.height=null,this.width=null,document.body.insertBefore(this.containerCanvas,document.body.firstChild),document.body.insertBefore(this.convertorCanvas,document.body.firstChild)}n.r(e),n.d(e,"CropperjsGif",function(){return a});var o={IMAGE_LOAD_ERROR:"IMAGE_LOAD_ERROR",IMAGE_READ_ERROR:"IMAGE_READ_ERROR",DECODE_ERROR:"DECODE_ERROR",ENCODE_ERROR:"ENCODE_ERROR"};i.prototype.ERROR=o,i.prototype.crop=function(t,e){var n=t.getData(),i=this,o=this.calcLimitRatio(n),r={x:Math.round(n.x*o),y:Math.round(n.y*o),width:Math.round(n.width*o),height:Math.round(n.height*o),scaleX:n.scaleX*o,scaleY:n.scaleY*o,rotate:n.rotate};this.readAndDecodeGif(function(){i.setupCanvas(r,o),i.cropFrame(0,r,[],function(t){i.saveGif(r,t,function(t){e&&e(t)})})})},i.prototype.calcLimitRatio=function(t){var e=this.options.maxWidth/t.width,n=this.options.maxHeight/t.height;return e<1||n<1?Math.min(e,n):1},i.prototype.readAndDecodeGif=function(t){var e=this;this.image=new Image,this.image.onload=function(){e.width=this.naturalWidth||this.width,e.height=this.naturalHeight||this.height;var n=new XMLHttpRequest;n.responseType="arraybuffer",n.onreadystatechange=function(){4==n.readyState&&(200==n.status?e.decode(n.response,t):e.errorHandler(o.IMAGE_READ_ERROR,new Error(n.statusText)))},n.open("GET",e.options.src),n.send(null)},this.image.onerror=function(){e.errorHandler(o.IMAGE_LOAD_ERROR)},this.image.src=this.options.src},i.prototype.decode=function(t,e){try{var n=EasyGif.decoder(t);this.frames=n.decompressFrames(),e&&e()}catch(t){this.errorHandler(o.DECODE_ERROR,t)}},i.prototype.setupCanvas=function(t,e){var n=Math.PI/180*t.rotate,i=(this.width*Math.cos(n)+this.height*Math.sin(n))*e,o=(this.height*Math.cos(n)+this.width*Math.sin(n))*e;this.offsetX=-Math.min(t.x,0),this.offsetY=-Math.min(t.y,0),this.containerCenterX=this.offsetX+i/2,this.containerCenterY=this.offsetY+o/2,this.containerCanvas.width=Math.max(this.offsetX+i,this.offsetX+t.width,t.x+t.width),this.containerCanvas.height=Math.max(this.offsetY+o,this.offsetY+t.height,t.y+t.height),this.containerCtx.clearRect(0,0,this.containerCanvas.width,this.containerCanvas.height),this.convertorCanvas.width=this.width,this.convertorCanvas.height=this.height},i.prototype.cropFrame=function(t,e,n,i){var o,a=this.frames[t],s=EasyGif.frameToImageData(this.containerCtx,a),h=this;this.containerCtx.save(),this.containerCtx.translate(this.containerCenterX,this.containerCenterY),this.containerCtx.rotate(e.rotate*Math.PI/180),this.containerCtx.scale(e.scaleX,e.scaleY),this.containerCtx.drawImage(this.drawImgDataToCanvas(a,s),-s.width/2,-s.height/2),this.containerCtx.restore(),0==t&&this.containerCtx.globalCompositeOperation&&(this.containerCtx.fillStyle=this.options.background,this.containerCtx.globalCompositeOperation="destination-over",this.containerCtx.fillRect(0,0,this.containerCanvas.width,this.containerCanvas.height),this.containerCtx.globalCompositeOperation="source-over"),o=this.containerCtx.getImageData(e.x+this.offsetX,e.y+this.offsetY,e.width,e.height),n.push(o),++t<this.frames.length?r(function(){h.cropFrame(t,e,n,i)}):i&&i(n)},i.prototype.drawImgDataToCanvas=function(t,e){return this.convertorCtx.clearRect(0,0,this.width,this.height),this.convertorCtx.putImageData(e,t.dims.left,t.dims.top),this.convertorCanvas},i.prototype.saveGif=function(t,e,n){var i=this.options.encoder||{};i.width=t.width,i.height=t.height;try{for(var r=EasyGif.encoder(i),a=0;a<e.length;a++)r.addFrame(e[a],{delay:this.frames[a].delay});r.on("finished",function(t){n&&n(t)}),r.render()}catch(t){this.errorHandler(o.DECODE_ERROR,t)}},i.prototype.errorHandler=function(t,e){this.options.onerror&&this.options.onerror(t,e)};var r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.setTimeout,a={crop:function(t,e,n){return new i(t).crop(e,n)}}}}));
//# sourceMappingURL=cropperjs-gif.js.map