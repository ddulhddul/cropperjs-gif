/*! Project: https://github.com/wmlgl/cropperjs-gif, license: MIT */
!function(t,e){for(var i in e)t[i]=e[i]}(window,function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=2)}({2:function(t,e,i){"use strict";function n(t){t.background=t.background||"#fff",this.options=t,this.containerCanvas=document.createElement("canvas"),this.containerCtx=this.containerCanvas.getContext("2d"),this.convertorCanvas=document.createElement("canvas"),this.convertorCtx=this.convertorCanvas.getContext("2d"),this.containerCenterX=null,this.containerCenterY=null,this.image=null,this.height=null,this.width=null}i.r(e),i.d(e,"CropperjsGif",function(){return a});var r={IMAGE_LOAD_ERROR:"IMAGE_LOAD_ERROR",IMAGE_READ_ERROR:"IMAGE_READ_ERROR",DECODE_ERROR:"DECODE_ERROR",ENCODE_ERROR:"ENCODE_ERROR"};n.prototype.ERROR=r,n.prototype.crop=function(t,e){var i=t.getData(),n=this,r=this.calcLimitRatio(i),o={x:Math.round(i.x*r),y:Math.round(i.y*r),width:Math.round(i.width*r),height:Math.round(i.height*r),scaleX:i.scaleX*r,scaleY:i.scaleY*r,rotate:i.rotate};this.readAndDecodeGif(function(){n.setupCanvas(o,r),n.cropFrame(0,o,[],function(t){n.saveGif(o,t,function(t){e&&e(t)})})})},n.prototype.calcLimitRatio=function(t){var e=this.options.maxWidth/t.width,i=this.options.maxHeight/t.height;return e<1||i<1?Math.min(e,i):1},n.prototype.readAndDecodeGif=function(t){var e=this;this.image=new Image,this.image.onload=function(){e.width=this.naturalWidth||this.width,e.height=this.naturalHeight||this.height;var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=function(){4==i.readyState&&(200==i.status?e.decode(i.response,t):e.errorHandler(r.IMAGE_READ_ERROR,new Error(i.statusText)))},i.open("GET",e.options.src),i.send(null)},this.image.onerror=function(){e.errorHandler(r.IMAGE_LOAD_ERROR)},this.image.src=this.options.src},n.prototype.decode=function(t,e){try{var i=EasyGif.decoder(t);this.frames=i.decompressFrames(),e&&e()}catch(t){this.errorHandler(r.DECODE_ERROR,t)}},n.prototype.setupCanvas=function(t,e){var i=Math.PI/180*t.rotate,n=(this.width*Math.cos(i)+this.height*Math.sin(i))*e,r=(this.height*Math.cos(i)+this.width*Math.sin(i))*e;this.offsetX=-Math.min(t.x,0),this.offsetY=-Math.min(t.y,0),this.containerCenterX=this.offsetX+n/2,this.containerCenterY=this.offsetY+r/2,this.containerCanvas.width=Math.max(this.offsetX+n,this.offsetX+t.width,t.x+t.width),this.containerCanvas.height=Math.max(this.offsetY+r,this.offsetY+t.height,t.y+t.height),this.containerCtx.clearRect(0,0,this.containerCanvas.width,this.containerCanvas.height),this.convertorCanvas.width=this.width,this.convertorCanvas.height=this.height},n.prototype.cropFrame=function(t,e,i,n){var r,a=this.frames[t],s=EasyGif.frameToImageData(this.containerCtx,a),h=this;this.containerCtx.save(),this.containerCtx.translate(this.containerCenterX,this.containerCenterY),this.containerCtx.rotate(e.rotate*Math.PI/180),this.containerCtx.scale(e.scaleX,e.scaleY),this.containerCtx.drawImage(this.drawImgDataToCanvas(a,s),-s.width/2,-s.height/2),this.containerCtx.restore(),0==t&&this.containerCtx.globalCompositeOperation&&(this.containerCtx.fillStyle=this.options.background,this.containerCtx.globalCompositeOperation="destination-over",this.containerCtx.fillRect(0,0,this.containerCanvas.width,this.containerCanvas.height),this.containerCtx.globalCompositeOperation="source-over"),r=this.containerCtx.getImageData(e.x+this.offsetX,e.y+this.offsetY,e.width,e.height),i.push(r),++t<this.frames.length?o(function(){h.cropFrame(t,e,i,n)}):n&&n(i)},n.prototype.drawImgDataToCanvas=function(t,e){return this.convertorCtx.clearRect(0,0,this.width,this.height),this.convertorCtx.putImageData(e,t.dims.left,t.dims.top),this.convertorCanvas},n.prototype.saveGif=function(t,e,i){var n=this.options.encoder||{};n.width=t.width,n.height=t.height;try{for(var o=EasyGif.encoder(n),a=0;a<e.length;a++)o.addFrame(e[a],{delay:this.frames[a].delay});o.on("finished",function(t){i&&i(t)}),o.render()}catch(t){this.errorHandler(r.DECODE_ERROR,t)}},n.prototype.errorHandler=function(t,e){this.options.onerror&&this.options.onerror(t,e)};var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.setTimeout,a={crop:function(t,e,i){return new n(t).crop(e,i)}}}}));
//# sourceMappingURL=cropperjs-gif.js.map